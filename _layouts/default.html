<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: 'zh-CN' }}">
  {% include head-custom.html %}
  <body>
    <div class="wrapper">
      <header class="sidebar">
        <div class="sidebar-inner">
          <div class="profile-section">
            <a href="{{ site.github.url }}/" class="avatar-link">
              <img src="https://github.com/{{ site.github_username }}.png" alt="Avatar" class="avatar">
            </a>
            <h2 class="site-title"><a href="{{ site.github.url }}/">{{ site.title }}</a></h2>
          </div>

          <!-- 侧边栏导航区：图标 + 文字 -->
          <nav class="info-section">
            <ul class="contact-list">
              <!-- GitHub -->
              <li>
                <a href="https://github.com/{{ site.github_username }}" target="_blank" class="icon-link" title="GitHub">
                  <span class="icon"><i class="fab fa-github"></i></span>
                  <span class="text">GitHub Profile</span>
                </a>
              </li>
              
              <!-- Email -->
              <li>
                <a href="mailto:{{ site.email }}" class="icon-link" title="Email">
                  <span class="icon"><i class="fas fa-envelope"></i></span>
                  <span class="text">Email Me</span>
                </a>
              </li>

              <!-- Git Branch Info (交互式跳转) -->
              <li>
                {% assign branch_name = site.github.source.branch | default: 'main' %}
                {% if site.github.repository_url %}
                  {% assign repo_url = site.github.repository_url %}
                {% else %}
                  <!-- 本地回退逻辑：手动拼接 https://github.com/ + user/repo -->
                  {% assign repo_url = "https://github.com/" | append: site.repository %}
                {% endif %}
                <!-- 构建 Branch URL: https://github.com/User/Repo/tree/Branch -->
                <a href="{{ repo_url }}/tree/{{ branch_name }}" target="_blank" class="icon-link branch-link" title="Current Branch">
                  <span class="icon"><i class="fas fa-code-branch"></i></span>
                  <span class="text">
                    {{ branch_name }}
                    {% if site.github.build_revision %}
                    <span class="commit-hash">({{ site.github.build_revision | slice: 0, 7 }})</span>
                    {% endif %}
                  </span>
                </a>
              </li>

              <li>
                <div class="icon-link theme-toggle" onclick="toggleTheme()">
                  <span class="icon" id="theme-icon"><i class="fas fa-moon"></i></span>
                  <span class="text" id="theme-text">Dark Mode</span>
                </div>
              </li>
            </ul>
          </nav>

          {% if page.layout == 'post' %}
            <div class="post-sidebar-meta">
              <hr>
              {% include post-meta.html %}
              <div id="toc-container" class="toc-container">
                <h3><i class="fas fa-list-ul"></i> 目录</h3>
                <div id="toc"></div>
              </div>
            </div>
          {% endif %}
        </div>
      </header>

      <section class="main-content">
        {{ content }}
        <footer class="site-footer">
          <p class="copyright">© {{ site.time | date: '%Y' }} {{ site.title }}. Powered by Jekyll.</p>
        </footer>
      </section>
    </div>
    
    <script src="{{ '/assets/js/main.js' | relative_url }}"></script>
    
    <!-- KaTeX 自动渲染配置 -->
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "$", right: "$", display: false}
          ]
        });
      });
    </script>
  </body>
</html>