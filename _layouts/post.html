---
layout: default
---

<article class="post-content">
  <header class="post-header">
    <h1 class="post-title">{{ page.title }}</h1>
    <p class="post-date"><i class="far fa-calendar-alt"></i> {{ page.date | date: "%Y-%m-%d" }}</p>
  </header>

  <div class="post-body">
    {{ content }}
  </div>

  <!-- 
    === 核心修复逻辑：基于子文件夹的独立索引 === 
  -->
  <div class="post-navigation">
    <!-- 1. 获取当前文章的目录路径 (不包含文件名) -->
    {% assign path_array = page.path | split: '/' %}
    {% assign array_size = path_array | size %}
    {% assign dir_depth = array_size | minus: 1 %}
    {% assign current_dir = path_array | slice: 0, dir_depth | join: '/' %}

    <!-- 2. 创建一个空数组用于存放同目录的文章 -->
    {% assign sibling_posts = "" | split: "" %}

    <!-- 3. 遍历所有文章，筛选出物理路径相同的文章 -->
    {% for post in site.posts %}
      {% assign post_path_array = post.path | split: '/' %}
      {% assign post_array_size = post_path_array | size %}
      {% assign post_dir_depth = post_array_size | minus: 1 %}
      {% assign post_dir = post_path_array | slice: 0, post_dir_depth | join: '/' %}

      {% if post_dir == current_dir %}
        {% assign sibling_posts = sibling_posts | push: post %}
      {% endif %}
    {% endfor %}

    <!-- 
      注意：site.posts 默认是按时间【从新到旧】排序的。
      筛选出的 sibling_posts 依然保持这个顺序：
      Index 0: 最新 (Newest)
      ...
      Index N: 最旧 (Oldest)
    -->

    <!-- 4. 在筛选后的数组中找到当前文章的索引 -->
    {% assign currIndex = -1 %}
    {% for post in sibling_posts %}
      {% if post.path == page.path %}
        {% assign currIndex = forloop.index0 %}
      {% endif %}
    {% endfor %}

    <!-- 5. 计算逻辑索引 -->
    <!-- 下一篇 (更近的日期) = 索引减 1 -->
    {% assign nextIndex = currIndex | minus: 1 %}
    <!-- 上一篇 (更远的日期) = 索引加 1 -->
    {% assign prevIndex = currIndex | plus: 1 %}

    <!-- 6. 渲染按钮 -->
    <!-- 上一篇 (旧文章) -->
    {% if prevIndex < sibling_posts.size %}
      {% assign prev_post = sibling_posts[prevIndex] %}
      <a class="nav-btn prev" href="{{ prev_post.url | relative_url }}">
        <span class="label"><i class="fas fa-arrow-left"></i> 上一篇</span>
        <span class="title">{{ prev_post.title }}</span>
      </a>
    {% else %}
      <div class="nav-btn-placeholder"></div>
    {% endif %}

    <!-- 下一篇 (新文章) -->
    {% if nextIndex >= 0 %}
      {% assign next_post = sibling_posts[nextIndex] %}
      <a class="nav-btn next" href="{{ next_post.url | relative_url }}">
         <span class="label">下一篇 <i class="fas fa-arrow-right"></i></span>
         <span class="title">{{ next_post.title }}</span>
      </a>
    {% else %}
      <div class="nav-btn-placeholder"></div>
    {% endif %}

  </div>

  <div class="post-back-home">
    <a href="{{ '/' | relative_url }}" class="back-home-btn">
      <i class="fas fa-home"></i> 返回首页
    </a>
  </div>
</article>